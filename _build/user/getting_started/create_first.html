

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing Your First Workflow &mdash; Flyte 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Flyte Concepts" href="../concepts/index.html" />
    <link rel="prev" title="Quick Start Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Flyte
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Flyte Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User docs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="examples.html">Quick Start Examples</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Writing Your First Workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-project">Creating a Project</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-a-task">Writing a Task</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-a-workflow">Writing a Workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interacting-with-flyte">Interacting with Flyte</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/index.html">Flyte Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/index.html">Flyte Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasktypes/index.html">Flyte Task Types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../administrator/index.html">Administrator Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor/index.html">Contributor Docs</a></li>
</ul>
<p class="caption"><span class="caption-text">Generated Documentation from Source</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/lyft/flyteidl">Flyte Language Specification</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Flyte</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User docs</a> &raquo;</li>
        
          <li><a href="index.html">Getting Started</a> &raquo;</li>
        
      <li>Writing Your First Workflow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/user/getting_started/create_first.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-your-first-workflow">
<span id="getting-started-create-first"></span><h1>Writing Your First Workflow<a class="headerlink" href="#writing-your-first-workflow" title="Permalink to this headline">¶</a></h1>
<p>The easiest way to author a Flyte Workflow is using the provided python SDK called “FlyteKit”.</p>
<p>You can save some effort by cloning the <code class="docutils literal notranslate"><span class="pre">flytesnacks</span></code> repo, and re-initializing it as a new git repository</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">lyft</span><span class="o">/</span><span class="n">flytesnacks</span><span class="o">.</span><span class="n">git</span> <span class="n">myflyteproject</span>
<span class="n">cd</span> <span class="n">myworkflow</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">init</span>
</pre></div>
</div>
<p>now open the “Makefile” and change the first line to <code class="docutils literal notranslate"><span class="pre">IMAGE_NAME=myflyteproject</span></code></p>
<p>Let’s also remove the existing python task so we can write one from scratch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="n">workflows</span><span class="o">/</span><span class="n">edges</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="section" id="creating-a-project">
<h2>Creating a Project<a class="headerlink" href="#creating-a-project" title="Permalink to this headline">¶</a></h2>
<p>In Flyte, workflows are organized into namespaces called “Projects”. When you register a workflow, it must be registered under a project.</p>
<p>Lets create a new project called <code class="docutils literal notranslate"><span class="pre">myflyteproject</span></code>. Use the project creation endpoint to create the new project</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">30081</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">projects</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;project&quot;: {&quot;id&quot;: &quot;myflyteproject&quot;, &quot;name&quot;: &quot;myflyteproject&quot;} }&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-a-task">
<h2>Writing a Task<a class="headerlink" href="#writing-a-task" title="Permalink to this headline">¶</a></h2>
<p>The most basic Flyte primitive is a “task”. Flyte Tasks are units of work that can be composed in a workflow. The simplest way to write a Flyte task is using the FlyteSDK.</p>
<p>Start by creating a new file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">workflows</span><span class="o">/</span><span class="n">first</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This directory has been marked in the <a class="reference external" href="https://github.com/lyft/flytesnacks/blob/764b82aca5701137ebc0eda4e818466e5acc9219/sandbox.config#L2">configuration file</a> as the location to look for workflows and tasks.  Begin by importing some of the libraries that we’ll need for this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">urllib.request</span> <span class="kn">as</span> <span class="nn">_request</span>

<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">flytekit.common</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">flytekit.sdk.tasks</span> <span class="kn">import</span> <span class="n">python_task</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">inputs</span>
<span class="kn">from</span> <span class="nn">flytekit.sdk.types</span> <span class="kn">import</span> <span class="n">Types</span>
<span class="kn">from</span> <span class="nn">flytekit.sdk.workflow</span> <span class="kn">import</span> <span class="n">workflow_class</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">Input</span>
</pre></div>
</div>
<p>From there, we can begin to write our first task.  It should look something like this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@inputs</span><span class="p">(</span><span class="n">image_location</span><span class="o">=</span><span class="n">Types</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
<span class="nd">@outputs</span><span class="p">(</span><span class="n">parsed_image</span><span class="o">=</span><span class="n">Types</span><span class="o">.</span><span class="n">Blob</span><span class="p">)</span>
<span class="nd">@python_task</span>
<span class="k">def</span> <span class="nf">edge_detection_canny</span><span class="p">(</span><span class="n">wf_params</span><span class="p">,</span> <span class="n">image_location</span><span class="p">,</span> <span class="n">parsed_image</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">AutoDeletingTempDir</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
        <span class="n">plane_fname</span> <span class="o">=</span> <span class="s1">&#39;{}/plane.jpg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">_request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">image_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">plane_fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opfile</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">opfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">plane_fname</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># hysteresis thresholds</span>

        <span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;{}/output.jpg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">edges</span><span class="p">)</span>

        <span class="n">parsed_image</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Some of the new concepts demonstrated here are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wf_params</span></code>: The first argument to a python task is a Flyte SDK defined object that offers handlers like logging.</p></li>
<li><p>Inputs and outputs are first defined in the decorator, and then passed into the argument of the function.  Note that the names in the function signature need to match those in the decorator arguments.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">Blob</span></code> is a Flyte Kit type that represents binary data.  It is used to offload data to a storage location like S3.  Here we use it to store an image.</p></li>
</ul>
</div>
<div class="section" id="writing-a-workflow">
<h2>Writing a Workflow<a class="headerlink" href="#writing-a-workflow" title="Permalink to this headline">¶</a></h2>
<p>Next you need to call that task from a workflow.  In the same file, add these lines.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@workflow_class</span>
<span class="k">class</span> <span class="nc">EdgeDetectorWf</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">image_input</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Image to run for&quot;</span><span class="p">)</span>
    <span class="n">run_edge_detection</span> <span class="o">=</span> <span class="n">edge_detection_canny</span><span class="p">(</span><span class="n">image_location</span><span class="o">=</span><span class="n">image_input</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="n">run_edge_detection</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">parsed_image</span><span class="p">,</span> <span class="n">sdk_type</span><span class="o">=</span><span class="n">Types</span><span class="o">.</span><span class="n">Blob</span><span class="p">)</span>
</pre></div>
</div>
<p>This code block creates a workflow, with one task. The workflow itself has an input (the link to an image) that gets passed into the task, and an output, which is the processed image.</p>
</div>
<div class="section" id="interacting-with-flyte">
<h2>Interacting with Flyte<a class="headerlink" href="#interacting-with-flyte" title="Permalink to this headline">¶</a></h2>
<p>Flyte fulfills tasks using docker images. You’ll need to build a docker image from this code before it can run in Flyte. The repo has a make target to build the docker image for you</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">docker_build</span>
</pre></div>
</div>
<p>If you have the flyte sandbox installed on your local machine, the image will be accessible to to your Flyte system. If you’re running a remote Flyte instance, you’ll need to upload this image to a remote registry such as Dockerhub, Amazon ECR, or Google Container Registry, so that it can be used by the Flyte system.</p>
<p>To upload to a remote registry, use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DOCKER_REGISRY_USERNAME</span><span class="o">=</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="n">DOCKER_REGISTRY_PASSWORD</span><span class="o">=</span><span class="p">{</span><span class="k">pass</span><span class="p">}</span> <span class="n">REGISTRY</span><span class="o">=</span><span class="n">docker</span><span class="o">.</span><span class="n">io</span> <span class="n">make</span> <span class="n">docker_build</span>
</pre></div>
</div>
<p>Replace the values above with your registry username, password, and registry endpoint.</p>
<p>You may need to change the <code class="docutils literal notranslate"><span class="pre">IMAGE_NAME</span></code> in the Makefile to reflect your namespace in the docker registry. (ex <code class="docutils literal notranslate"><span class="pre">{{my</span> <span class="pre">docker</span> <span class="pre">username}}/myflyteproject</span></code>)</p>
<p>With the image built, we just need to register the tasks and workflows. The process is the same as what we had done previously.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">network</span> <span class="n">host</span> <span class="o">-</span><span class="n">e</span> <span class="n">FLYTE_PLATFORM_URL</span><span class="o">=</span><span class="s1">&#39;127.0.0.1:30081&#39;</span> <span class="p">{{</span> <span class="n">your</span> <span class="n">docker</span> <span class="n">image</span> <span class="p">}}</span> <span class="n">pyflyte</span> <span class="o">-</span><span class="n">p</span> <span class="n">myflyteproject</span> <span class="o">-</span><span class="n">d</span> <span class="n">development</span> <span class="o">-</span><span class="n">c</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">config</span> <span class="n">register</span> <span class="n">workflows</span>
</pre></div>
</div>
<p>After this, you should be able to visit the Flyte UI, and run the workflow as you did with <code class="docutils literal notranslate"><span class="pre">flytesnacks</span></code> previously.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../concepts/index.html" class="btn btn-neutral float-right" title="Flyte Concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="examples.html" class="btn btn-neutral float-left" title="Quick Start Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Flyte Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>