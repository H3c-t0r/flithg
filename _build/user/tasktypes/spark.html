

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spark Task &mdash; Flyte 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Dynamic Tasks" href="dynamic.html" />
    <link rel="prev" title="Hive Tasks" href="hive.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Flyte
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Flyte Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/index.html">Flyte Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/index.html">Flyte Features</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Flyte Task Types</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="container.html">Container Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="hive.html">Hive Tasks</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Spark Task</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dynamic.html">Dynamic Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="sidecar.html">Sidecar Tasks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../administrator/index.html">Administrator Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor/index.html">Contributor Docs</a></li>
</ul>
<p class="caption"><span class="caption-text">Generated Documentation from Source</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/lyft/flyteidl">Flyte Language Specification</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Flyte</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User docs</a> &raquo;</li>
        
          <li><a href="index.html">Flyte Task Types</a> &raquo;</li>
        
      <li>Spark Task</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/user/tasktypes/spark.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spark-task">
<span id="spark-task-type"></span><h1>Spark Task<a class="headerlink" href="#spark-task" title="Permalink to this headline">¶</a></h1>
<p>Spark Task Type allows users to write a Spark Job which are then executed on the Kubernetes cluster via the <a class="reference external" href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator">SparkOperator</a>.</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Spark on Kubernetes is containerized i.e. your own repo image is run as Spark driver and executors hence we need to have Spark and it’s dependencies installed in the user’s container.</p>
<p>One way to achieve this is to build relevant images for your use-case using <a class="reference external" href="https://github.com/apache/spark/blob/master/resource-managers/kubernetes/docker/src/main/dockerfiles/spark/Dockerfile#L22">Dockerfile</a> which already exist as part of the Spark distribution. <a class="reference external" href="https://github.com/lyft/flytekit/tree/master/scripts">Flytekit</a> also provides <em>flytekit_install_spark.sh</em> and <em>flytekit_spark_entrypoint.sh</em> which can be used to install spark dependencies/set the correct entrypoint for Spark Tasks in an user image.</p>
<p>Please refer to <a class="reference external" href="https://spark.apache.org/docs/latest/running-on-kubernetes.html">Spark Documentation</a> for details on Spark on K8s.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The following is an example of a simple Spark job which calculates the value of Pi.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Simple Spark Job example</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@spark_task</span><span class="p">(</span>
    <span class="n">spark_conf</span><span class="o">=</span><span class="p">{</span>
      <span class="s1">&#39;spark.driver.memory&#39;</span><span class="p">:</span> <span class="s2">&quot;1000M&quot;</span><span class="p">,</span>
      <span class="s1">&#39;spark.executor.memory&#39;</span><span class="p">:</span> <span class="s2">&quot;1000M&quot;</span><span class="p">,</span>
      <span class="s1">&#39;spark.executor.cores&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
      <span class="s1">&#39;spark.executor.instances&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
    <span class="p">},</span>
 <span class="p">)</span>
 <span class="k">def</span> <span class="nf">hello_spark</span><span class="p">(</span><span class="n">workflow_parameters</span><span class="p">,</span> <span class="n">spark_context</span><span class="p">,</span> <span class="n">partitions</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
     <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Starting Spark with Partitions: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partitions</span><span class="p">))</span>
     <span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span> <span class="o">*</span> <span class="n">partitions</span>
     <span class="n">count</span> <span class="o">=</span> <span class="n">spark_context</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">partitions</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
     <span class="n">pi_val</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">count</span> <span class="o">/</span> <span class="n">n</span>
     <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Pi val is :{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi_val</span><span class="p">))</span>
     <span class="n">out</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pi_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This is a pretty simple job. It calculates the value of Pi and sets it as the output for the task. The task takes in <cite>spark_conf</cite> and <cite>hadoop_conf</cite> where the user can provide any custom spark and hadoop config required for the Spark Task.</p>
<p><a class="reference external" href="https://github.com/lyft/flytekit/blob/master/tests/flytekit/common/workflows/spark.py">Flyte Workflow Demo - Spark Workflow</a> is a Spark Workflow example which uses the Spark Task defined above.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dynamic.html" class="btn btn-neutral float-right" title="Dynamic Tasks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hive.html" class="btn btn-neutral float-left" title="Hive Tasks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Flyte Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>