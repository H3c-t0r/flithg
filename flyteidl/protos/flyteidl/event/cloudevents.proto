syntax = "proto3";

package flyteidl.event;

option go_package = "github.com/flyteorg/flyte/flyteidl/gen/pb-go/flyteidl/event";

import "flyteidl/event/event.proto";
import "flyteidl/core/literals.proto";
import "flyteidl/core/interface.proto";
import "flyteidl/core/artifact_id.proto";
import "flyteidl/core/identifier.proto";
import "google/protobuf/timestamp.proto";

// This is the cloud event parallel to the raw WorkflowExecutionEvent message. It's filled in with additional
// information that downstream consumers may find useful.
message CloudEventWorkflowExecution {
  event.WorkflowExecutionEvent raw_event = 1;

  core.LiteralMap output_data = 2;

  core.TypedInterface output_interface = 3;

  core.LiteralMap input_data = 4;

  // The following are ExecutionMetadata fields
  // We can't have the ExecutionMetadata object directly because of import cycle
  repeated core.ArtifactID artifact_ids = 6;
  core.NodeExecutionIdentifier parent_node_execution = 7;
  core.WorkflowExecutionIdentifier reference_execution = 8;

  // The ID of the LP that generated the execution that generated the Artifact.
  // Here for provenance information.
  // Launch plan IDs are easier to get than workflow IDs so we'll use these for now.
  core.Identifier launch_plan_id = 9;
}


message CloudEventNodeExecution {
  event.NodeExecutionEvent raw_event = 1;

  // ID of the task. In combination with the retryAttempt this will indicate
  // the task execution uniquely for a given parent node execution.
  // need to copy
  core.Identifier task_id = 2;

  // retry attempt number for this task, ie., 2 for the second attempt
  // need to copy
  uint32 retry_attempt = 3;

  // Hydrated output
  core.LiteralMap output_data = 4;

  // The typed interface for the task that produced the event.
  core.TypedInterface output_interface = 5;

  core.LiteralMap input_data = 6;

  // The ID of the LP that generated the execution that generated the Artifact.
  // Here for provenance information.
  // Launch plan IDs are easier to get than workflow IDs so we'll use these for now.
  core.Identifier launch_plan_id = 9;
}

message CloudEventTaskExecution {
  event.TaskExecutionEvent raw_event = 1;
}

// This event is to be sent by Admin after it creates an execution.
message CloudEventExecutionStart {
  // The execution created.
  core.WorkflowExecutionIdentifier execution_id = 1;
  // The launch plan used.
  core.Identifier launch_plan_id = 2;

  core.Identifier workflow_id = 3;

  // Artifact IDs found
  repeated core.ArtifactID artifact_ids = 4;

  // Artifact keys found.
  repeated string artifact_keys = 5;
}
